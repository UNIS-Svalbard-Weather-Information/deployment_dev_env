localhost {
    # Proxy the deegree console (root and static resources)
    handle_path /deegree-webservices/* {
        reverse_proxy http://mapserver:8080 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # Proxy the mapserver services
    handle_path /mapserver/* {
        rewrite * /deegree-webservices/{path}
        reverse_proxy http://mapserver:8080 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # Proxy the root (console) to the deegree backend
    handle / {
        reverse_proxy http://mapserver:8080 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
}
